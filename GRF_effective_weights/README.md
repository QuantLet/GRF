[<img src="https://github.com/QuantLet/Styleguide-and-FAQ/blob/master/pictures/banner.png" width="888" alt="Visit QuantNet">](http://quantlet.de/)

## [<img src="https://github.com/QuantLet/Styleguide-and-FAQ/blob/master/pictures/qloqo.png" alt="Visit QuantNet">](http://quantlet.de/) **GRF_effective_weights** [<img src="https://github.com/QuantLet/Styleguide-and-FAQ/blob/master/pictures/QN2.png" width="60" alt="Visit QuantNet 2.0">](http://quantlet.de/)

```yaml


Name of Quantlet: GRF_effective_weights

Published in: 'GRF'

Description: 'Estimation of effective weights alpha_i(x) for the infeasable observations theta_tilde. The effective weights are computed by a regression forest on n=500, 1000, 2000 observations of grid data x_i = -1 + 2*i/n and target variable Y_i=theta(x_i) + eps_i, for a given theta function, here triangle function theta(x) = max(0, 1 - |x|/0.2), with Gaussian noise eps_i with mean zero and standard deviation of 0 and 0.1.'

Keywords: 'RF, GRF, infeasable function, estimation, effective weights, bandwidth'

Author: 'Marius Sterling'

See also: ''

Submitted:  '15.01.2021'

```

![Picture1](RF_theta_triangle___effective_weights___sigma000___xi0000.png)

![Picture2](RF_theta_triangle___effective_weights___sigma000___xi0020.png)

![Picture3](RF_theta_triangle___effective_weights___sigma000___xi0040.png)

![Picture4](RF_theta_triangle___effective_weights___sigma000___xi0060.png)

![Picture5](RF_theta_triangle___effective_weights___sigma000___xi0080.png)

![Picture6](RF_theta_triangle___effective_weights___sigma000___xi0100.png)

![Picture7](RF_theta_triangle___effective_weights___sigma000___xi0120.png)

![Picture8](RF_theta_triangle___effective_weights___sigma000___xi0140.png)

![Picture9](RF_theta_triangle___effective_weights___sigma000___xi0160.png)

![Picture10](RF_theta_triangle___effective_weights___sigma000___xi0180.png)

![Picture11](RF_theta_triangle___effective_weights___sigma000___xi0200.png)

![Picture12](RF_theta_triangle___effective_weights___sigma000___xi0220.png)

![Picture13](RF_theta_triangle___effective_weights___sigma000___xi0240.png)

![Picture14](RF_theta_triangle___effective_weights___sigma000___xi0260.png)

![Picture15](RF_theta_triangle___effective_weights___sigma000___xi0280.png)

![Picture16](RF_theta_triangle___effective_weights___sigma000___xi0300.png)

![Picture17](RF_theta_triangle___effective_weights___sigma000___xi0320.png)

![Picture18](RF_theta_triangle___effective_weights___sigma000___xi0340.png)

![Picture19](RF_theta_triangle___effective_weights___sigma000___xi0360.png)

![Picture20](RF_theta_triangle___effective_weights___sigma000___xi0380.png)

![Picture21](RF_theta_triangle___effective_weights___sigma000___xi0400.png)

![Picture22](RF_theta_triangle___effective_weights___sigma000___xi0420.png)

![Picture23](RF_theta_triangle___effective_weights___sigma000___xi0440.png)

![Picture24](RF_theta_triangle___effective_weights___sigma000___xi0460.png)

![Picture25](RF_theta_triangle___effective_weights___sigma000___xi0480.png)

![Picture26](RF_theta_triangle___effective_weights___sigma000___xi0500.png)

![Picture27](RF_theta_triangle___effective_weights___sigma000___xi0520.png)

![Picture28](RF_theta_triangle___effective_weights___sigma000___xi0540.png)

![Picture29](RF_theta_triangle___effective_weights___sigma000___xi0560.png)

![Picture30](RF_theta_triangle___effective_weights___sigma000___xi0580.png)

![Picture31](RF_theta_triangle___effective_weights___sigma000___xi0600.png)

![Picture32](RF_theta_triangle___effective_weights___sigma000___xi0620.png)

![Picture33](RF_theta_triangle___effective_weights___sigma000___xi0640.png)

![Picture34](RF_theta_triangle___effective_weights___sigma000___xi0660.png)

![Picture35](RF_theta_triangle___effective_weights___sigma000___xi0680.png)

![Picture36](RF_theta_triangle___effective_weights___sigma000___xi0700.png)

![Picture37](RF_theta_triangle___effective_weights___sigma000___xi0720.png)

![Picture38](RF_theta_triangle___effective_weights___sigma000___xi0740.png)

![Picture39](RF_theta_triangle___effective_weights___sigma000___xi0760.png)

![Picture40](RF_theta_triangle___effective_weights___sigma000___xi0780.png)

![Picture41](RF_theta_triangle___effective_weights___sigma000___xi0800.png)

![Picture42](RF_theta_triangle___effective_weights___sigma000___xi0820.png)

![Picture43](RF_theta_triangle___effective_weights___sigma000___xi0840.png)

![Picture44](RF_theta_triangle___effective_weights___sigma000___xi0860.png)

![Picture45](RF_theta_triangle___effective_weights___sigma000___xi0880.png)

![Picture46](RF_theta_triangle___effective_weights___sigma000___xi0900.png)

![Picture47](RF_theta_triangle___effective_weights___sigma000___xi0920.png)

![Picture48](RF_theta_triangle___effective_weights___sigma000___xi0940.png)

![Picture49](RF_theta_triangle___effective_weights___sigma000___xi0960.png)

![Picture50](RF_theta_triangle___effective_weights___sigma000___xi0980.png)

![Picture51](RF_theta_triangle___effective_weights___sigma000___xi1000.png)

![Picture52](RF_theta_triangle___effective_weights___sigma010___xi0000.png)

![Picture53](RF_theta_triangle___effective_weights___sigma010___xi0020.png)

![Picture54](RF_theta_triangle___effective_weights___sigma010___xi0040.png)

![Picture55](RF_theta_triangle___effective_weights___sigma010___xi0060.png)

![Picture56](RF_theta_triangle___effective_weights___sigma010___xi0080.png)

![Picture57](RF_theta_triangle___effective_weights___sigma010___xi0100.png)

![Picture58](RF_theta_triangle___effective_weights___sigma010___xi0120.png)

![Picture59](RF_theta_triangle___effective_weights___sigma010___xi0140.png)

![Picture60](RF_theta_triangle___effective_weights___sigma010___xi0160.png)

![Picture61](RF_theta_triangle___effective_weights___sigma010___xi0180.png)

![Picture62](RF_theta_triangle___effective_weights___sigma010___xi0200.png)

![Picture63](RF_theta_triangle___effective_weights___sigma010___xi0220.png)

![Picture64](RF_theta_triangle___effective_weights___sigma010___xi0240.png)

![Picture65](RF_theta_triangle___effective_weights___sigma010___xi0260.png)

![Picture66](RF_theta_triangle___effective_weights___sigma010___xi0280.png)

![Picture67](RF_theta_triangle___effective_weights___sigma010___xi0300.png)

![Picture68](RF_theta_triangle___effective_weights___sigma010___xi0320.png)

![Picture69](RF_theta_triangle___effective_weights___sigma010___xi0340.png)

![Picture70](RF_theta_triangle___effective_weights___sigma010___xi0360.png)

![Picture71](RF_theta_triangle___effective_weights___sigma010___xi0380.png)

![Picture72](RF_theta_triangle___effective_weights___sigma010___xi0400.png)

![Picture73](RF_theta_triangle___effective_weights___sigma010___xi0420.png)

![Picture74](RF_theta_triangle___effective_weights___sigma010___xi0440.png)

![Picture75](RF_theta_triangle___effective_weights___sigma010___xi0460.png)

![Picture76](RF_theta_triangle___effective_weights___sigma010___xi0480.png)

![Picture77](RF_theta_triangle___effective_weights___sigma010___xi0500.png)

![Picture78](RF_theta_triangle___effective_weights___sigma010___xi0520.png)

![Picture79](RF_theta_triangle___effective_weights___sigma010___xi0540.png)

![Picture80](RF_theta_triangle___effective_weights___sigma010___xi0560.png)

![Picture81](RF_theta_triangle___effective_weights___sigma010___xi0580.png)

![Picture82](RF_theta_triangle___effective_weights___sigma010___xi0600.png)

![Picture83](RF_theta_triangle___effective_weights___sigma010___xi0620.png)

![Picture84](RF_theta_triangle___effective_weights___sigma010___xi0640.png)

![Picture85](RF_theta_triangle___effective_weights___sigma010___xi0660.png)

![Picture86](RF_theta_triangle___effective_weights___sigma010___xi0680.png)

![Picture87](RF_theta_triangle___effective_weights___sigma010___xi0700.png)

![Picture88](RF_theta_triangle___effective_weights___sigma010___xi0720.png)

![Picture89](RF_theta_triangle___effective_weights___sigma010___xi0740.png)

![Picture90](RF_theta_triangle___effective_weights___sigma010___xi0760.png)

![Picture91](RF_theta_triangle___effective_weights___sigma010___xi0780.png)

![Picture92](RF_theta_triangle___effective_weights___sigma010___xi0800.png)

![Picture93](RF_theta_triangle___effective_weights___sigma010___xi0820.png)

![Picture94](RF_theta_triangle___effective_weights___sigma010___xi0840.png)

![Picture95](RF_theta_triangle___effective_weights___sigma010___xi0860.png)

![Picture96](RF_theta_triangle___effective_weights___sigma010___xi0880.png)

![Picture97](RF_theta_triangle___effective_weights___sigma010___xi0900.png)

![Picture98](RF_theta_triangle___effective_weights___sigma010___xi0920.png)

![Picture99](RF_theta_triangle___effective_weights___sigma010___xi0940.png)

![Picture100](RF_theta_triangle___effective_weights___sigma010___xi0960.png)

![Picture101](RF_theta_triangle___effective_weights___sigma010___xi0980.png)

![Picture102](RF_theta_triangle___effective_weights___sigma010___xi1000.png)

![Picture103](RF_theta_triangle___theta_tilde___sigma000_n0500.png)

![Picture104](RF_theta_triangle___theta_tilde___sigma000_n1000.png)

![Picture105](RF_theta_triangle___theta_tilde___sigma000_n2000.png)

![Picture106](RF_theta_triangle___theta_tilde___sigma010_n0500.png)

![Picture107](RF_theta_triangle___theta_tilde___sigma010_n1000.png)

![Picture108](RF_theta_triangle___theta_tilde___sigma010_n2000.png)

### R Code
```r

rm(list=ls())
library(grf)
library(ggplot2)
library(glue)
set.seed(42)


get_x = function(n){
  X = matrix((-(n / 2 - 1):(n / 2)) / (n / 2), nrow = n)
  colnames(X) = 'X1'
  return(X)
}
theta_triangle = function(x, width){
  pmax(1 - abs((x) / width), 0)
}

get_y = function(X, theta, sigma, seed=NULL){
  set.seed(NULL)
  n = nrow(X)
  return(theta(X) + rnorm(n, 0, sigma))
}

for (sig in c(0, 0.1)){
  rfs = list()
  for (n in c(500, 1000, 2000)){
    width = 0.2
    X = get_x(n)
    theta = function(X) theta_triangle(X, width)
    Y = get_y(X, theta, sig, 42)
    rf = regression_forest(X, Y)
    eps_tilde = Y - theta(X)
    alpha = get_sample_weights(rf)
    theta_tilde = theta(X) + alpha %*% eps_tilde
    
    pdf(file = glue('RF_theta_triangle___theta_tilde___sigma{formatC(sig*100, width=3, flag="0")}_n{formatC(n, width=4, flag="0")}.pdf'))
      plot(X[, 'X1'], Y, type = 'p', pch = 20, cex = 0.25, xlab='X1')
      lines(X[, 'X1'], theta_tilde, col = 'red')
      lines(X[, 'X1'], theta(X), col = 'blue', lty=2)
    dev.off()
    rfs[[as.character(n)]] = rf
  }
  
  x1s = get_x(100)
  alpha = lapply(rfs, function(x) get_sample_weights(x, newdata = x1s))
  rf_X.orig = lapply(rfs, function(x) x$X.orig[, 'X1'])
  for (i in 1:nrow(x1s)){
    pdf(file = glue('RF_theta_triangle___effective_weights___sigma{formatC(sig*100, width=3, flag="0")}___xi{formatC(x1s[i]*1000, width=4, flag="0")}.pdf'))
      # m = max(sapply(rfs, function(x)max(get_sample_weights(x)[])))
      plot(
        rf_X.orig[[1]],
        alpha[[1]][i, ],
        xlab = 'x', 
        ylab = parse(text = 'alpha[i](x)'),
        main = bquote('Effective weights'~alpha[i](x) ~'for' ~ X[i] == .(x1s[i])),
        type = 'l',
        ylim = c(0, 0.1)
      )
      lines(rf_X.orig[[2]], alpha[[2]][i, ], col = 'blue')
      lines(rf_X.orig[[3]], alpha[[3]][i, ], col = 'red')
    dev.off()
  }
}
```

automatically created on 2021-01-19